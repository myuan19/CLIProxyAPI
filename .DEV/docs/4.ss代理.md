## AuthFiles 模型弹窗里的代理状态小点

在「支持的模型」弹窗底部，代理 URL 旁边的小圆点：

| 颜色 | 含义 | 说明 |
|------|------|------|
| **绿色** (`proxyDotUsed`) | 代理：已使用 | 健康检查请求实际走了该凭证配置的代理（如 SS） |
| **红色** (`proxyDotUnused`) | 代理：未使用 | 健康检查未走代理，直连上游 |

对应文案：

- 绿色：`proxy_used_tooltip` → "代理：已使用"
- 红色：`proxy_not_used_tooltip` → "代理：未使用"

---

# √ 绿色代表本次检查使用了代理（无论通不通），红色就是没使用（具体原因取决于什么时候走，例如当前是ss格式错误时候不走）

---

是的，你的理解是对的。

---

## 逻辑确认

- **绿色**：本次健康检查**使用了代理**（请求确实走配置的代理，不论是否成功）
- **红色**：本次健康检查**没有使用代理**（没有走代理，具体原因取决于配置和解析结果）

---

## 代码依据

`proxy_used` 来自 `ProxyUsedForAuth`，本质是「该 auth 是否有可用的 RoundTripper」：

```go
// ProxyUsedForAuth returns true if the given auth would use a proxy (non-nil RoundTripper from provider).
func (m *Manager) ProxyUsedForAuth(auth *Auth) bool {
	return m.roundTripperFor(auth) != nil
}
```

- 返回 `true`：RoundTripper 创建成功，健康检查请求会通过该 transport 走代理 → 小点**绿色**
- 返回 `false`：RoundTripper 为 nil，请求只能直连 → 小点**红色**

---

## 红色常见原因（未使用代理）

在 `rtprovider.go` 中，RoundTripper 为 nil 的情况包括：

- `auth.ProxyURL` 为空
- SS URL 解析失败（格式错误）
- DoT 解析失败（配置了 `proxy-dns` 但解析失败）
- SS cipher 创建失败（加密方法不支持等）
- 其他 scheme 不支持

这些都会导致 RoundTripper 为 nil，从而 `proxy_used = false`，小点显示**红色**。

---

## 总结

你的理解可以概括为：

- **绿色**：本次检查使用了代理（已尝试走代理，和通不通无关）
- **红色**：本次检查没有使用代理（原因可以是未配置、SS 格式错误、解析失败等）

---

那如果绿色代理不通，会重试吗

结论：AuthFiles 健康检查不会在代理不通时做重试，也不会回退到直连。

---

所以说，绿色只是说明走了代理。就算是绿色，也可能是代理不通。而且不带重试，也不会回退到直连（红色表示走了直连）。